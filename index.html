<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>D3up.com by aaroncox</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<style type="text/css" media="screen">
			#header {
				position: relative;
			}
			section {
				margin-top: 10px;
			}
			code {
				color: #111;
				background-color: #ececec;
				margin: 0px;
				padding: 2px;
			}
			pre {
				border: 0;
				padding: 2px;
			}
			pre .comment {
				color: #888;
			}
		</style>
  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/D3Up/D3Up.com">View On GitHub</a></li>
					<li class="fork downloads"><a href="http://d3up.com">Goto D3Up.com</a></li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>D3up.com Development</h1>
          <p>Help develop Diablo 3 Tools</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/aaroncox">aaroncox</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h2>D3Up.com - Version 2.0</h2>

<p>Welcome to the D3Up.com Github Repository!</p>

<h2>Sections of this Document</h2>

<ul>
<li><a href="#intro">Project Introduction</a></li>
<li><a href="#communication">Ways to Communicate</a></li>
<li><a href="#components">Frameworks, Languages, and Components</a></li>
<li><a href="#environment">Setting up a Development Environment</a></li>
<li><a href="#unittests">Unit Testing your Code</a></li>
<li><a href="#pullrequests">Submitting your Code</a></li>
<li><a href="#database">The Database</a></li>
<li><a href="#contributors">Contributors and Thanks</a>
<li><a href="#license">License</a></li>
</ul>
<h2><a id="communicate"></a>Project Introduction</h2>
<p>To start off with, if I had to sum up the goals of D3Up.com into a sentence, it would be as follows:</p>
<blockquote>D3Up.com is a tool to help players learn about Diablo 3 characters, the game mechanics behind them, and determine ways to push their character to the limit.</blockquote>
<br/>
<p>I've been working on D3Up.com solo since June of 2012 and decided to make this a much more community project. Up until this point, I've never released any codebase this large on github or as an open source project. Please bear with me and feel free to make suggestions on how things should or shouldn't be done (in a constructive way).</p>
<p>I still have an overall vision for the site and plan on steering towards it, focusing on being a learning tool first and everything else second. To start I plan on being the only person accepting pull requests, which will most likely change over time if people contribute.</p>
<p>Please don't get offended if I ask you to change something in your pull request. Feel free to try to convince me otherwise, but if I have a good reason, I'm not just going to cave. For example, if you try to:</p>
<ul>
	<li>Add a forum to the site, I'll say no. Remember, learning game mechanics, exploring stats, theorycrafting, not complaining about how OP barbarians are.</li>
	<li>Provide a logo, design or graphic I don't like, I'll say no. While my design skills may not be top notch, I do have an opinion on design matters.</li>
	<li>Write code that's poorly optimized / implemented, I'll probably say no. Mind you, if I commit some crappy code, call me out on it or comment what could be done better, I'll listen. I plan on doing the same, providing constructive feedback.</li>
	<li>Commit stuff that breaks unit tests, I'll complain probably. Please test stuff, don't break things! If I break things, by all means, complain.</li>
</ul>
<p>I'd also like to say that some of you are going to cringe at code you find, as I'm going to cringe right back at some of the code submitted in your pull requests. Parts of the code were written almost a year ago and in a rush, in what extra free time I had. Other parts of the code were somewhat of a learning experiences for me that never got revisited and improved upon, which lead me to... The Calculator. It's a monster and has been hacked apart so much I barely recognize it. So, I apologize when your head explodes inside `/public/js`. It works however, and as you'll see below, I'm not planning on focusing on it for the 2.0 release.</p>
<p>I think I've put enough disclaimers, so to wrap up the introduction, here's my plan for Version 2:</p>
<ol>
	<li>(v2.0) Build the PHP/Laravel/MongoDB Backend using Handlebars to serve out V1 Calculator values</li>
	<li>(v2.1) Rewrite the Calculator and Game Data tools to fit the new Backend/Handlebars</li>
	<li>(v2.2) TBD - Wherever the community leads</li>
</ol>
<p>I'm hoping that v2.0 will be ready this summer, and maybe aim for 2.1 this fall/winter.</p>
<p>Thanks for your interest in the project and feel free to contact me.</p>
<h2><a id="communicate"></a>Ways to Communicate</h2>
<p>I've setup numerous ways for anyone wishing to participate to join in the development discussion. Listed below are the three primary methods of communication I use.</p>
<ul>
<li>
<strong>Github Issues</strong> - Please use the <a href="https://github.com/D3Up/D3Up.com/issues">Github Issues</a> section of the project for any bugs or features you'd like to request, talk about or get help with.</li>
<li>
<strong>Reddit</strong> - For anything else, or if you just are a bigger reddit fan, feel free to post anything D3Up related on <a href="http://reddit.com/r/d3up">/r/d3up</a>.</li>
<li>
<strong>IRC</strong> - If you're IRC savvy, feel free to join the chat on <code>irc.esper.net</code> in the channel <code>#d3up</code>. Github notifications and Jenkins both notify the #d3up channel of any activity on the master branch of the project.</li>
</ul><h2>
<a id="components"></a>Frameworks, Languages, and Components</h2>

<p>Server Languages/Components:</p>

<ul>
<li><a href="http://php.net">PHP 5.4</a></li>
<li><a href="http://mongodb.org">MongoDB 2.0+</a></li>
<li>A web server that supports URL rewrites, nginx, apache, etc</li>
</ul><p>D3Up uses the following frameworks/bundles:</p>

<ul>
<li>
<a href="http://laravel.com">Laravel v3</a> - PHP Framework

<ul>
<li>MyUnit (Bundle) - PHPUnit Wrapper for Laravel</li>
<li>Binder (Bundle) - HTML Helpers</li>
<li>S3 (Bundle) - Allows communication with Amazon S3</li>
</ul>
</li>
<li>
<a href="http://github.com/aaroncox/epicmongo">EpicMongo</a> - PHP/MongoDB ORM</li>
<li>
<a href="http://jquery.com">jQuery</a> - Javascript Engine</li>
<li>
<a href="http://underscorejs.org">underscore</a> - Javascript Framework (the Calculators use)</li>
<li>
<a href="http://handlebarsjs.com">HandleBars</a> - Javascript Templating Engine</li>
<li>
<a href="twitter.github.com/bootstrap/base-css.html">Bootstrap</a> - CSS Framework / Utilities</li>
</ul><p><strong>EditorConfig</strong> - D3Up uses <a href="http://editorconfig.org">EditorConfig</a> to ensure everyones tabs and spaces are properly aligned. Please make sure you're using an Editor/IDE that supports EditorConfig and please enable it!</p>

<h2>
<a id="environment"></a>Setting up your Environement</h2>

<p>If you're wanting to setup a local instance of D3Up, here's a few things you'll need to do:</p>

<ul>
<li>Fork the repository so you have your own copy to work on and submit pull requests from.</li>
<li>Clone the Repository to your machine and setup your web server to handle requests to it.</li>
<li>Please make sure to use `local.d3up.com` as the vhost/dns name for your version, it will force the application to use the development environment. If you need to use something else, please add the hostname to <a href="https://github.com/D3Up/D3Up.com/blob/master/paths.php#L25">paths.php</a> under 'development'.</li>
<li>Copy <code>application/config/application.template</code> to <code>application/config/application.php</code> and change the <code>key</code> in the file to a unique value.</li>
<li>Make sure to run <code>git submodule update --init</code> to pull in a copy of the libraries/bundles it uses.</li>
<li>Make sure to run <code>php artisan bundle:upgrade</code> to pull in a copy of the bundles needed in Laravel.</li>
</ul><h2>
<a id="unittests"></a>Passing the Unit Tests</h2>

<p>My goal here is to ensure all tests (located in the <code>application/tests</code> folder) pass after any changes are made..</p>

<p>Currently, there is no javascript testing framework. The javascript is still a monstrosity from Version 1, and I'd honestly like to rewrite it with some guidance from the JS community.</p>

<p>Laravel makes testing easy, you can run the tests by executing the following command from the command line (in the D3Up.com folder):</p>

<p><code>php artisan myunit</code></p>

<p>This requires that PHPUnit is installed on your system, just google for <code>phpunit install [insert your OS here]</code> to find out how.</p>

<p>I also have Jenkins running to notify the #d3up IRC channel whenever changes are applies to the master branch and whether or not they pass the unit tests. You can view all of the results on <a href="http://jenkins.greymass.com">jenkins.greymass.com</a>.</p>

<h2>
<a id="pullrequests"></a>Submitting Changes</h2>

<p>All changes submitted must be in the form of a <em>Pull Request</em>, which will then be reviewed by the community and once accepted, will be merged into the live codebase and deployed to D3Up.com.</p>

<p>I'd recommend reading <a href="https://help.github.com/articles/using-pull-requests">Using Pull Requests</a> on github:help or doing some searches for more information. I don't want to clutter up this documentation too much with how pull requests work.</p>

<h2><a id="database"></a>The Database</h2>
<p>D3Up.com uses <a href="http://www.mongodb.org/">MongoDB</a> for it's database engine. If you're interested in doing anything regarding the database itself, I'd recommend learning about MongoDB. I won't be distributing access to the live database, but I will make a copy of the database available for testing.</p>
<h3>MongoDB Collections</h3>
<p>The site primarily uses two collections, <strong>Builds</strong> and <strong>Items</strong>. The site also has about 8 other collections, but they are primarily system related, and as this documentation evolves, I'll review them as well.</p>
<h3>The Builds Collection</h3>
<p>The build's collection is where all of the character builds are stored. I'm going to use my build as an example of how the data is laid out, with comments on each field.</p>
<pre>
{
<span class='comment'>// MongoDB Assigned ObjectID</span>
"_id" : ObjectId("5015ead717bbcb1a6b000eab"),
<span class='comment'>// Battle.net BattleTag</span>
"_characterBt" : "jesta#1121",
<span class='comment'>// Battle.net Character ID</span>
"_characterId" : "1107072",
<span class='comment'>// Battle.net Region (1 = US, 2 = EU, 3 = CN)</span>
"_characterRg" : "1",
<span class='comment'>// When this build was created</span>
"_created" : NumberLong(1343613655),
<span class='comment'>// Who created this build and owns it</span>
"_createdBy" : DBRef("users", ObjectId("4fe8ccb617bbcbdd59000dfe")),
<span class='comment'>// This is a gear cache, which caches the characters gear as embedded documents</span>
"_gear" : {
	<span class='comment'>(I emptied this data, they look like the items below)</span>
	"helm" : {},
	"chest" : {},
	"boots" : {},
	"gloves" : {},
	"shoulders" : {},
	"pants" : {},
	"bracers" : {},
	"mainhand" : {},
	"offhand" : {},
	"belt" : {},
	"ring2" : {},
	"ring1" : {},
	"amulet" : {}
},
<span class='comment'>// Battle.net's Time on the last update to the armory</span>
"_lastBnetUpdate" : NumberLong(1361039573),
<span class='comment'>// Last time the user issued a Battle.net Sync</span>
"_lastCrawl" : NumberLong(1365996786),
<span class='comment'>// The Active Skills used by this build</span>
"actives" : [
	"weapon-throw~c",
	"whirlwind~c",
	"sprint~c",
	"battle-rage~d",
	"war-cry~c",
	"wrath-of-the-berserker~d"
],
<span class='comment'>// The Class of the Build</span>
"class" : "barbarian",
<span class='comment'>// Database references to all of your gear by slot</span>
"gear" : {
	"helm" : DBRef("items", ObjectId("50fb864b17bbcbaf1c000030")),
	"chest" : DBRef("items", ObjectId("50fb864b17bbcbaf1c000032")),
	"boots" : DBRef("items", ObjectId("50fb864b17bbcbaf1c000034")),
	"gloves" : DBRef("items", ObjectId("50fb864c17bbcbaf1c000036")),
	"shoulders" : DBRef("items", ObjectId("50fb864c17bbcbaf1c000038")),
	"pants" : DBRef("items", ObjectId("50fb864c17bbcbaf1c00003a")),
	"bracers" : DBRef("items", ObjectId("50fb864c17bbcbaf1c00003c")),
	"offhand" : DBRef("items", ObjectId("515fa83817bbcb2c74000acf")),
	"mainhand" : DBRef("items", ObjectId("515d92b317bbcb24390000e7")),
	"belt" : DBRef("items", ObjectId("50fb864d17bbcbaf1c000042")),
	"ring2" : DBRef("items", ObjectId("50fb864d17bbcbaf1c000046")),
	"ring1" : DBRef("items", ObjectId("50fb864d17bbcbaf1c000044")),
	"amulet" : DBRef("items", ObjectId("50fb864d17bbcbaf1c000048"))
},
<span class='comment'>// Gender (0 = Male, 1 = Female)</span>
"gender" : NumberLong(0),
<span class='comment'>// Is this character hardcore?</span>
"hardcore" : false,
<span class='comment'>// Numeric ID (Used in the URL)</span>
"id" : 1,
<span class='comment'>// Level</span>
"level" : NumberLong(60),
<span class='comment'>// Character Name</span>
"name" : "Jesta",
<span class='comment'>// Paragon Level</span>
"paragon" : NumberLong(60),
<span class='comment'>// The Passive Skills this build uses</span>
"passives" : [
	"ruthless",
	"weapons-master",
	"no-escape"
],
"stats" : {
	<span class='comment'>// A gigantic array of stats, cached from the Javascript Calculator.</span>
	<span class='comment'>// Again, I remove this to reduce the size of this code block.</span>
},
<span class='comment'>// How many Views this build has received</span>
"views" : NumberLong(21349)
}
</pre>
<p>If you're familiar with MongoDB, the document shouldn't seem too strange to you. However, if you've never experienced MongoDB before, you should note that the documents stored within are JSON. This lets us store arrays and objects within fields and do some awesome querying.</p>
<p>I'm not going to list out all the indexes and extra info, but you can find that information contained in the <a href="https://github.com/D3Up/D3Up.com/blob/master/application/models/D3Up/Schema.php">application/models/D3Up/Schema.php</a>. These indexes are build/ensured whenever the artisan command <code>php artisan dbcheck</code> is executed. It only does indexes currently, but I plan on making this task execute other maintenance tasks as well.</p>
<p>A small preview of some of the queries issued against builds are as follows:</p>
<pre>
<span class='comment'>// Loads Build #1</span>
db.builds.findOne({id: 1});
<span class='comment'>// Loads Demon Hunters</span>
db.builds.find({class: 'demon-hunter'});
<span class='comment'>// Loads Monks and sorts by EHP descending</span>
db.builds.find({class: 'monk'}).sort({'stats.ehp': -1});
<span class='comment'>// Loads Barbarians that use Whirlwind - Hurricane and Sprint - RtlW </span>
<span class='comment'>// and then sorts by DPS descending</span>
db.builds.find({
	class: 'barbarian', 
	actives: {$all: ['sprint~c', 'whirlwind~c']}
}).sort({'stats.dps': -1});
</pre>
<p>This documentation on builds will eventually be broken out into it's own documentation, but to get the ball rolling, it will exist here. Feel free to ask questions!</p>
<h3>The Items Collection</h3>
<p>The Item collection is a bit less complex, as it just contains single instances of items. However, it's also the largest collection, and requires the most indexing and disk space.</p>
<pre>
{
<span class='comment'>// MongoDB Assigned ObjectID</span>
"_id" : ObjectId("50fb864b17bbcbaf1c000030"),
<span class='comment'>// Once again, time created</span>
"_created" : NumberLong(1358661195),
<span class='comment'>// The owner of the item, who can edit</span>
"_createdBy" : DBRef("users", ObjectId("4fe8ccb617bbcbdd59000dfe")),
<span class='comment'>// The last time this item was accessed, for future cleanup</span>
"_lastViewed" : NumberLong(1358661320),
<span class='comment'>// The Attributes of the Item (<a href="http://cl.ly/image/362U0b0q0s2c">These Values</a>)</span>
"attrs" : {
	"strength" : 155,
	"poison-resist" : 48,
	"attack-speed" : 9,
	"life-regen" : 180,
	"critical-hit" : 4.5
},
<span class='comment'>// Battle.net's icon name</span>
"icon" : "unique_helm_003_104_demonhunter_male",
<span class='comment'>// The Numeric ID for the Item</span>
"id" : NumberLong(4070159),
<span class='comment'>// Item's Name</span>
"name" : "Andariel's Visage",
<span class='comment'>// The quality, (6 = Legendary)</span>
"quality" : NumberLong(6),
<span class='comment'>// The "Ratings" of each attribute</span>
"rating" : {
	"strength" : 77.5,
	"poison-resist" : 80,
	"life-regen" : 52.6,
	"critical-hit" : 75,
	"total" : 71.275
},
<span class='comment'>// An array of sockets, each containing a gem</span>
"sockets" : [
	"radiant_star_ruby" <span class='comment'>// A Gem (<a href="https://github.com/D3Up/D3Up.com/blob/master/application/libraries/D3Up/Gems.php">Referenced Here</a></span>)
],
<span class='comment'>// The Item's generated Stats (<a href="http://cl.ly/image/2s3Y3G3H2t1C">These Values</a>)</span>
"stats" : {
	"armor" : 377
},
<span class='comment'>// The Type of Item</span>
"type" : "helm"
}
</pre>
<p>The item itself contains any and all information needed to use that item in calculations and build a tooltip. It's not incredibly complex, but the complexity comes in from the sheer amount of them existing in the database.</p>
<p>If you didn't notice, that's actually the helmet that my barbarian uses.
<pre>
<span class='comment'>// My Build, the gear field</span>
gear: {
	"helm" : DBRef("items", ObjectId("50fb864b17bbcbaf1c000030")),
}
<span class='comment'>// The above item's _id field</span>
"_id" : ObjectId("50fb864b17bbcbaf1c000030")
</pre>
<p>Those two collections make up for the vast majority of database activity, and the corresponding PHP models can be located here:</p>
<ul>
	<li><strong>Build:</strong> <a href="https://github.com/D3Up/D3Up.com/blob/master/application/models/D3Up/Build.php">/application/models/D3Up/Build.php</a></li>
	<li><strong>Item:</strong> <a href="https://github.com/D3Up/D3Up.com/blob/master/application/models/D3Up/Item.php">/application/models/D3Up/Item.php</a></li>
</ul>
<h2><a id="contributions"></a>Contributors and Thanks</h2>

<h2><a id="license"></a>License</h2>

<p>This code is released under the <a href="/D3Up/D3Up.com/blob/master/license.txt">MIT License</a>.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-39563326-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>